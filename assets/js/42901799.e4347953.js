"use strict";(self.webpackChunksailpoint_developer_portal=self.webpackChunksailpoint_developer_portal||[]).push([[29165],{664032:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var i=t(785893),r=t(511151);const o={id:"webservices-before-provisioning-rule",title:"Web Services Before Operation Rule",pagination_label:"Web Services Before Operation Rule",sidebar_label:"Web Services Before Operation Rule",sidebar_class_name:"webServicesBeforeOperationRule",keywords:["cloud","rules","webservices"],description:"This rule calculates attributes before a web-service operation call.",slug:"/extensibility/rules/connector-rules/webservices-before-provisioning-rule",tags:["Rules"]},s=void 0,l={id:"extensibility/rules/connector-rules/webservices-before-provisioning-rule",title:"Web Services Before Operation Rule",description:"This rule calculates attributes before a web-service operation call.",source:"@site/docs/extensibility/rules/connector-rules/web_services_before_operation_rule.md",sourceDirName:"extensibility/rules/connector-rules",slug:"/extensibility/rules/connector-rules/webservices-before-provisioning-rule",permalink:"/docs/extensibility/rules/connector-rules/webservices-before-provisioning-rule",draft:!1,unlisted:!1,editUrl:"https://github.com/sailpoint-oss/developer-community-site/edit/main/docs/extensibility/rules/connector-rules/web_services_before_operation_rule.md",tags:[{inline:!0,label:"Rules",permalink:"/docs/tags/rules"}],version:"current",lastUpdatedBy:"GitHub Action Bot",lastUpdatedAt:1726169183e3,frontMatter:{id:"webservices-before-provisioning-rule",title:"Web Services Before Operation Rule",pagination_label:"Web Services Before Operation Rule",sidebar_label:"Web Services Before Operation Rule",sidebar_class_name:"webServicesBeforeOperationRule",keywords:["cloud","rules","webservices"],description:"This rule calculates attributes before a web-service operation call.",slug:"/extensibility/rules/connector-rules/webservices-before-provisioning-rule",tags:["Rules"]},sidebar:"openApiSidebar",previous:{title:"Web Services After Operation Rule",permalink:"/docs/extensibility/rules/connector-rules/webservices-after-provisioning-rule"},next:{title:"Identity Security Cloud Rule Utility",permalink:"/docs/extensibility/rules/rule-utility"}},a={},c=[{value:"Overview",id:"overview",level:2},{value:"Execution",id:"execution",level:2},{value:"Input",id:"input",level:2},{value:"Output",id:"output",level:2},{value:"Attach to Source",id:"attach-to-source",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"This rule calculates attributes before a web-service operation call."}),"\n",(0,i.jsx)(n.h2,{id:"execution",children:"Execution"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Connector Execution"})," - This rule executes within the virtual appliance. It may offer special abilities to perform connector-related functions, and it may offer managed connections to sources."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Logging"})," - Logging statements are viewable within the ccg.log on the virtual appliance, and they are viewable by SailPoint personnel."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Rule Execution",src:t(288763).Z+"",width:"1525",height:"618"})}),"\n",(0,i.jsx)(n.h2,{id:"input",children:"Input"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Argument"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"application"}),(0,i.jsx)(n.td,{children:"sailpoint.object.Application"}),(0,i.jsx)(n.td,{children:"Application whose data file is being processed."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"provisioningPlan"}),(0,i.jsx)(n.td,{children:"sailpoint.object.ProvisioningPlan"}),(0,i.jsx)(n.td,{children:"Provisioning plan used to update the payload of the http request. The provisioning plan has an account request that defines the operation to be performed on the account. An account request can contain multiple attributes requests. Each attribute request represents an operation on a single account attribute. This argument enables the user to update the body/payload or URL attributes of an endpoint object using the provisioningPlan information."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"requestEndPoint"}),(0,i.jsx)(n.td,{children:"sailpoint.connector.webservices.EndPoint"}),(0,i.jsx)(n.td,{children:"Current request information. It contains the header, body, context url, method type, response attribute map, and successful response code."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"restClient"}),(0,i.jsx)(n.td,{children:"sailpoint.connector.webservices.WebServicesClient"}),(0,i.jsx)(n.td,{children:"WebServicesClient (HttpClient) object that enables the user to call the Web Services API target system."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"oldResponseMap"}),(0,i.jsx)(n.td,{children:"java.util.Map"}),(0,i.jsx)(n.td,{children:"Response object returned from earlier endpoint configuration of the same operation type, like Account Aggregation, Get Object, etc."})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"output",children:"Output"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Argument"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"EndPoint / Map"}),(0,i.jsx)(n.td,{children:"sailpoint.connector.webservices.EndPoint / sailpoint.connector.webservices.Map"}),(0,i.jsxs)(n.td,{children:["The rule allows the user to return the endpoint object (requestEndPoint) or a map. The map can hold ",(0,i.jsx)(n.strong,{children:"updatedEndPoint"})," and ",(0,i.jsx)(n.strong,{children:"connectorStateMap"})," keys where the value expected are ",(0,i.jsx)(n.strong,{children:"Endpoint"})," (requestEndPoint) and ",(0,i.jsx)(n.strong,{children:"connectorStateMap"})," object respectively. The ",(0,i.jsx)(n.strong,{children:"connectorStateMap"})," object is a map that contains a key and a value for the attribute that must be updated in the application by the rule."]})]})})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<?xml version=\'1.0\' encoding=\'UTF-8\'?>\n<!DOCTYPE Rule PUBLIC "sailpoint.dtd" "sailpoint.dtd">\n<Rule name="Example Rule" type="WebServiceBeforeOperationRule">\n  <Description>Describe your rule here.</Description>\n  <Source><![CDATA[\n\n  // Add your logic here.\n\n  ]]></Source>\n</Rule>\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'<?xml version=\'1.0\' encoding=\'UTF-8\'?>\n<!DOCTYPE Rule PUBLIC "sailpoint.dtd" "sailpoint.dtd">\n<Rule name="Example Rule" type="WebServiceBeforeOperationRule">\n  <Description>This rule is used by the  Web Services connector before performing any operation like testconnection, aggregation etc.</Description>\n  <Source><![CDATA[\nimport java.util.ArrayList;\nimport java.util.HashMap;\nimport java.util.Map;\nimport connector.common.JsonUtil;\nimport connector.common.Util;\nimport sailpoint.connector.webservices.EndPoint;\nimport sailpoint.connector.webservices.WebServicesClient;\nimport sailpoint.object.Application;\nimport sailpoint.object.ProvisioningPlan;\nimport sailpoint.object.ProvisioningPlan.AccountRequest;\n\n        Map body = requestEndPoint.getBody();\n        String jsonBody = (String) body.get("jsonBody");\n        log.info("Rule - Modify Body: running");\n\n        try {\n\n            Map jsonMap = JsonUtil.toMap(jsonBody);\n            if (jsonMap != null) {\n                Object roleEntry = jsonMap.get("webSiteAndRole");\n                String role = "";\n                if (roleEntry != null && roleEntry instanceof ArrayList) {\n                    ArrayList rolesArray = (ArrayList) roleEntry;\n                    if (rolesArray.size() > 0) {\n                        role = (String) rolesArray.get(0);\n                    }\n                } else if (roleEntry != null) {\n                    role = (String) roleEntry;\n                }\n\n                jsonMap.remove("webSiteAndRole");\n                jsonMap.put("webSiteAndRole", role);\n\n                log.info("Rule - Modify Body: setting webSiteAndRole = " + role);\n                String webID = "";\n                if (provisioningPlan != null) {\n                    log.info("Rule - Modify Body: plan is not null");\n                    for (AccountRequest accReq : Util.iterate(provisioningPlan.getAccountRequests())) {\n                        log.info("Rule - Modify Body: iterating over account requests");\n                        for (ProvisioningPlan.AttributeRequest attReq : Util.iterate(accReq.getAttributeRequests())) {\n                            log.info("Rule - Modify Body: iterating over attribute requests");\n                            String attrName = attReq.getName();\n                            String value = null;\n                            if (attrName != null && "webId".equalsIgnoreCase(attrName)) {\n                                webID = (String) attReq.getValue();\n                                log.info("Rule - Modify Body: setting webID = " + webID);\n                            }\n                        }\n                    }\n                } else {\n                    log.info("Rule - Modify Body: plan is null");\n                }\n\n                if (!"".equals(webID)) {\n                    jsonMap.put("webID", webID);\n                }\n\n                // Add in any other missing fields that are required\n                if (!jsonMap.containsKey("webLogonEmail")) {\n                    jsonMap.put("webLogonEmail", "");\n                }\n                if (!jsonMap.containsKey("taxID")) {\n                    jsonMap.put("taxID", "");\n                }\n                if (!jsonMap.containsKey("taxIdType")) {\n                    jsonMap.put("taxIdType", "");\n                }\n                if (!jsonMap.containsKey("actorLogonId")) {\n                    jsonMap.put("actorLogonId", "");\n                }\n\n                String finalBody = JsonUtil.render(jsonMap);\n                body.put("jsonBody", finalBody);\n                requestEndPoint.setBody(body);\n            }\n        } catch (Exception ex) {\n            log.error("Rule - Modify Body: " + ex);\n        }\n\n        return requestEndPoint;\u200b\n  ]]></Source>\n</Rule>\n'})}),"\n",(0,i.jsx)(n.h2,{id:"attach-to-source",children:"Attach to Source"}),"\n",(0,i.jsxs)(n.p,{children:["Refer to ",(0,i.jsx)(n.a,{href:"/docs/extensibility/rules/connector-rules#webservicebeforeoperation-rule",children:"Attaching Connector-Related Rules to Sources"})," for details on how to attach your rule to your source."]})]})}function u(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},288763:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/connector_execution-da1c6db87e6d1b2b8d1f5398ce2f3501.png"}}]);